(()=>{var e,n={7575:(e,n,o)=>{const t=o(8625),r=o(9755);window.jQuery=r,window.SIP=t,r((function(){o(7915);const e=o(4633),n=o(5049)||window.RingCentral.WebPhone;var t=null,l=null,i=null,a=0,c=null,s=null,u=r("#app"),d=r("#template-login"),f=r("#template-auth-flow"),g=r("#template-call"),p=r("#template-incoming"),m=r("#template-accepted"),h=document.getElementById("remoteVideo"),v=document.getElementById("localVideo"),b=!0,w="";function y(e){return r(e.html())}function S(e,n,o,t,r,i,u){return a=u,c=t,localStorage.setItem("webPhoneServer",e||""),localStorage.setItem("webPhoneAppKey",n||""),localStorage.setItem("webPhoneAppSecret",o||""),localStorage.setItem("webPhoneLogin",t||""),localStorage.setItem("webPhoneExtension",r||""),localStorage.setItem("webPhonePassword",i||""),localStorage.setItem("webPhoneLogLevel",a||0),l.get("/restapi/v1.0/account/~/extension/~").then((function(e){return s=e.json(),console.log("Extension info",s),l.post("/client-info/sip-provision",{sipInfo:[{transport:"WSS"}]})})).then((function(e){return e.json()})).then(k).then(O).catch((function(e){console.error("Error in main promise chain"),console.error(e.stack||e)}))}function k(e){return e.sipInfo[0]||e.sipInfo,(i=new n(e,{enableDscp:!0,appKey:localStorage.getItem("webPhoneAppKey"),audioHelper:{enabled:!0,incoming:"audio/incoming.ogg",outgoing:"audio/outgoing.ogg"},logLevel:parseInt(a,10),appName:"WebPhoneDemo",appVersion:"1.0.0",media:{remote:h,local:v},enableQos:!0,enableMediaReportLogging:!0})).userAgent.audioHelper.setVolume(.3),i.userAgent.on("invite",A),i.userAgent.on("connecting",(function(){console.log("UA connecting")})),i.userAgent.on("connected",(function(){console.log("UA Connected")})),i.userAgent.on("disconnected",(function(){console.log("UA Disconnected")})),i.userAgent.on("registered",(function(){console.log("UA Registered")})),i.userAgent.on("unregistered",(function(){console.log("UA Unregistered")})),i.userAgent.on("registrationFailed",(function(){console.log("UA RegistrationFailed",arguments)})),i.userAgent.on("message",(function(){console.log("UA Message",arguments)})),i.userAgent.transport.on("switchBackProxy",(function(){console.log("switching back to primary outbound proxy"),i.userAgent.transport.reconnect(!0)})),i.userAgent.transport.on("closed",(function(){console.log("WebSocket closed.")})),i.userAgent.transport.on("transportError",(function(){console.log("WebSocket transportError occured")})),i.userAgent.transport.on("wsConnectionError",(function(){console.log("WebSocket wsConnectionError occured")})),i}function A(e){if(b=!1,console.log("EVENT: Invite",e.request),console.log("To",e.request.to.displayName,e.request.to.friendlyName),console.log("From",e.request.from.displayName,e.request.from.friendlyName),e.request.headers["Alert-Info"]&&"Auto Answer"===e.request.headers["Alert-Info"][0].raw)e.accept().then((function(){I(e)})).catch((function(e){console.error("Accept failed",e.stack||e)}));else{var n=y(p).modal({backdrop:"static"});n.find(".answer").on("click",(function(){n.find(".before-answer").css("display","none"),n.find(".answered").css("display",""),e.accept().then((function(){n.modal("hide"),I(e)})).catch((function(e){console.error("Accept failed",e.stack||e)}))})),n.find(".decline").on("click",(function(){e.reject(),n.modal("hide")})),n.find(".toVoicemail").on("click",(function(){e.toVoicemail(),n.modal("hide")})),n.find(".forward-form").on("submit",(function(o){o.preventDefault(),o.stopPropagation(),e.forward(n.find("input[name=forward]").val().trim()).then((function(){console.log("Forwarded"),n.modal("hide")})).catch((function(e){console.error("Forward failed",e.stack||e)}))})),n.find(".reply-form").on("submit",(function(o){o.preventDefault(),o.stopPropagation(),e.replyWithMessage({replyType:0,replyText:n.find("input[name=reply]").val()}).then((function(){console.log("Replied"),n.modal("hide")})).catch((function(e){console.error("Reply failed",e.stack||e)}))})),e.on("rejected",(function(){n.modal("hide")}))}}function I(e){console.log("EVENT: Accepted",e.request),console.log("To",e.request.to.displayName,e.request.to.friendlyName),console.log("From",e.request.from.displayName,e.request.from.friendlyName);var n=y(m).modal(),o=n.find(".info").eq(0),t=n.find("input[name=dtmf]").eq(0),r=n.find("input[name=transfer]").eq(0),a=n.find("input[name=flip]").eq(0),s=(n.find("input[name=conference]").eq(0),setInterval((function(){var n=e.startTime?Math.round((Date.now()-e.startTime)/1e3)+"s":"Ringing";o.text("time: "+n+"\nstartTime: "+JSON.stringify(e.startTime,null,2)+"\n")}),1e3));function u(){clearInterval(s),n.modal("hide")}n.find(".increase-volume").on("click",(function(){e.userAgent.audioHelper.setVolume((null!==e.userAgent.audioHelper.volume?e.userAgent.audioHelper.volume:.5)+.1)})),n.find(".decrease-volume").on("click",(function(){e.userAgent.audioHelper.setVolume((null!==e.userAgent.audioHelper.volume?e.userAgent.audioHelper.volume:.5)-.1)})),n.find(".mute").on("click",(function(){e.mute()})),n.find(".unmute").on("click",(function(){e.unmute()})),n.find(".hold").on("click",(function(){e.hold().then((function(){console.log("Holding")})).catch((function(e){console.error("Holding failed",e.stack||e)}))})),n.find(".unhold").on("click",(function(){e.unhold().then((function(){console.log("UnHolding")})).catch((function(e){console.error("UnHolding failed",e.stack||e)}))})),n.find(".startRecord").on("click",(function(){e.startRecord().then((function(){console.log("Recording Started")})).catch((function(e){console.error("Recording Start failed",e.stack||e)}))})),n.find(".stopRecord").on("click",(function(){e.stopRecord().then((function(){console.log("Recording Stopped")})).catch((function(e){console.error("Recording Stop failed",e.stack||e)}))})),n.find(".park").on("click",(function(){e.park().then((function(){console.log("Parked")})).catch((function(e){console.error("Park failed",e.stack||e)}))})),n.find(".transfer-form").on("submit",(function(o){o.preventDefault(),o.stopPropagation(),e.transfer(r.val().trim()).then((function(){console.log("Transferred"),n.modal("hide")})).catch((function(e){console.error("Transfer failed",e.stack||e)}))})),n.find(".transfer-form button.warm").on("click",(function(o){o.preventDefault(),o.stopPropagation(),e.hold().then((function(){console.log("Placing the call on hold, initiating attended transfer");var o=e.userAgent.invite(r.val().trim());o.on("established",(function(){console.log("New call initated. Click Complete to complete the transfer"),n.find(".transfer-form button.complete").on("click",(function(t){e.warmTransfer(o).then((function(){console.log("Warm transfer completed"),n.modal("hide")})).catch((function(e){console.error("Transfer failed",e.stack||e)}))}))}))}))})),n.find(".flip-form").on("submit",(function(n){n.preventDefault(),n.stopPropagation(),e.flip(a.val().trim()).then((function(){console.log("Flipped")})).catch((function(e){console.error("Flip failed",e.stack||e)})),a.val("")})),n.find(".dtmf-form").on("submit",(function(n){n.preventDefault(),n.stopPropagation(),e.dtmf(t.val().trim()),t.val("")})),n.find(".startConf").on("click",(function(e){D||l.get("/restapi/v1.0/account/~/extension/~/presence?detailedTelephonyState=true").then((e=>{var n=e.json(),o=n.activeCalls[0].partyId,t=n.activeCalls[0].telephonySessionId;l.post("/restapi/v1.0/account/~/telephony/conference",{}).then((e=>(w=e.json().session.id,e.json().session.voiceCallToken))).then((e=>{!function(e,n,o){var t=i.userAgent.invite(e,{fromNumber:c});t.on("established",(function(){I(t),console.log("Conference call started"),function(e,n){var o="/restapi/v1.0/account/accountId/telephony/sessions/"+w+"/parties/bring-in";return l.post(o,{telephonySessionId:e,partyId:n})}(o,n).then((e=>{console.log("Adding call to conference succesful",e.json())})).catch((function(e){console.error("Conference call failed",e.stack||e)}))}))}(e,o,t),D=!0}))}))})),n.find(".hangup").on("click",(function(){e.dispose()})),e.on("established",(function(){console.log("Event: Established"),function(e){const n=b?"Outbound":"Inbound";var o={id:"",from:"",to:"",direction:"",sipData:{toTag:"",fromTag:""}};o.from=e.request.from.uri.user,o.to=e.request.to.uri.user,o.direction=n,o.id=e.dialog.id.callId,o.sipData.fromTag=e.dialog.remoteTag,o.sipData.toTag=e.dialog.localTag,localStorage.getItem("activeCallInfo")||localStorage.setItem("activeCallInfo",JSON.stringify(o))}(e)})),e.on("progress",(function(){console.log("Event: Progress")})),e.on("rejected",(function(){console.log("Event: Rejected"),u()})),e.on("failed",(function(){console.log("Event: Failed",arguments),u()})),e.on("terminated",(function(){console.log("Event: Terminated"),localStorage.setItem("activeCallInfo",""),u()})),e.on("cancel",(function(){console.log("Event: Cancel"),u()})),e.on("refer",(function(){console.log("Event: Refer"),u()})),e.on("replaced",(function(n){console.log("Event: Replaced: old session",e,"has been replaced with",n),u(),I(n)})),e.on("dtmf",(function(){console.log("Event: DTMF")})),e.on("muted",(function(){console.log("Event: Muted")})),e.on("unmuted",(function(){console.log("Event: Unmuted")})),e.on("connecting",(function(){console.log("Event: Connecting")})),e.on("bye",(function(){console.log("Event: Bye"),u()}))}var P,q,E,T,C,N,j,R,x,D=!1;function O(){var e=y(g),n=e.find("input[name=number]").eq(0),o=e.find("input[name=homeCountry]").eq(0),t=e.find(".username").eq(0),r=e.find(".logout").eq(0),l=e.find(".switch").eq(0);t.html("<dl><dt>Contact</dt><dd>"+s.contact.firstName+" "+s.contact.lastName+"</dd><dt>Company</dt><dd>"+(s.contact.company||"?")+"</dd><dt>Phone Number</dt><dd>"+c+"</dd></dl>"),r.on("click",(function(e){i.userAgent.unregister(),e.preventDefault(),location.reload()})),l.on("click",(function(e){var n;n=JSON.parse(localStorage.getItem("activeCallInfo")),console.log("Switching active call to current tab: ",n),I(i.userAgent.switchFrom(n))})),n.val(localStorage.getItem("webPhoneLastNumber")||""),e.on("submit",(function(e){var t,r;e.preventDefault(),e.stopPropagation(),localStorage.setItem("webPhoneLastNumber",n.val()||""),t=n.val(),r=o.val(),b=!0,r=r||s&&s.regionalSettings&&s.regionalSettings.homeCountry&&s.regionalSettings.homeCountry.id||null,I(i.userAgent.invite(t,{fromNumber:c,homeCountryId:r}))})),u.empty().append(e)}P=y(d),q=y(f),E=q.find("input[name=server]").eq(0),T=q.find("input[name=appKey]").eq(0),C=q.find("input[name=appSecret]").eq(0),N=P.find("input[name=login]").eq(0),j=P.find("input[name=extension]").eq(0),R=P.find("input[name=password]").eq(0),x=q.find("select[name=logLevel]").eq(0),E.val(localStorage.getItem("webPhoneServer")||e.server.sandbox),T.val(localStorage.getItem("webPhoneAppKey")||""),C.val(localStorage.getItem("webPhoneAppSecret")||""),N.val(localStorage.getItem("webPhoneLogin")||""),j.val(localStorage.getItem("webPhoneExtension")||""),R.val(localStorage.getItem("webPhonePassword")||""),x.val(localStorage.getItem("webPhoneLogLevel")||a),P.on("submit",(function(n){var o,r,i,a,c,s,u;console.log("Normal Flow"),n.preventDefault(),n.stopPropagation(),o=E.val(),r=T.val(),i=C.val(),a=N.val(),c=j.val(),s=R.val(),u=x.val(),t=new e({appKey:r,appSecret:i,server:o}),l=t.platform(),a&&(a=(a=a.match(/^[+1]/)?a:"1"+a).replace(/\W/g,"")),l.login({username:a,extension:c||null,password:s}).then((function(){return S(o,r,i,a,c,s,u)})).catch((function(e){console.error(e.stack||e)}))})),q.on("submit",(function(n){console.log("Authorized Flow"),n.preventDefault(),n.stopPropagation(),function(n,o,r,i){var a=decodeURIComponent(window.location.href.split("login",1)+"callback.html");console.log("The redirect uri value :",a),t=new e({appKey:o,appSecret:r,server:n,redirectUri:a});var c=(l=t.platform()).loginUrl();l.loginWindow({url:c}).then(l.login.bind(l)).then((function(){return S(n,o,r,"","","",i)})).catch((function(e){console.error(e.stack||e)}))}(E.val(),T.val(),C.val(),x.val())})),u.empty().append(q).append(P)}))},5049:e=>{"use strict";e.exports=void 0}},o={};function t(e){var r=o[e];if(void 0!==r)return r.exports;var l=o[e]={exports:{}};return n[e].call(l.exports,l,l.exports,t),l.exports}t.m=n,e=[],t.O=(n,o,r,l)=>{if(!o){var i=1/0;for(u=0;u<e.length;u++){for(var[o,r,l]=e[u],a=!0,c=0;c<o.length;c++)(!1&l||i>=l)&&Object.keys(t.O).every((e=>t.O[e](o[c])))?o.splice(c--,1):(a=!1,l<i&&(i=l));if(a){e.splice(u--,1);var s=r();void 0!==s&&(n=s)}}return n}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[o,r,l]},t.d=(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.j=577,(()=>{var e={577:0};t.O.j=n=>0===e[n];var n=(n,o)=>{var r,l,[i,a,c]=o,s=0;if(i.some((n=>0!==e[n]))){for(r in a)t.o(a,r)&&(t.m[r]=a[r]);if(c)var u=c(t)}for(n&&n(o);s<i.length;s++)l=i[s],t.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return t.O(u)},o=self.webpackChunkringcentral_web_phone=self.webpackChunkringcentral_web_phone||[];o.forEach(n.bind(null,0)),o.push=n.bind(null,o.push.bind(o))})();var r=t.O(void 0,[948],(()=>t(7575)));r=t.O(r)})();
//# sourceMappingURL=demo.js.map